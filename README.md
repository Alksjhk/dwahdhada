# è½»é‡çº§ç½‘é¡µèŠå¤©ç³»ç»Ÿ

åŸºäº React + Node.js + SQLite çš„è½»é‡çº§å®æ—¶èŠå¤©ç³»ç»Ÿï¼Œæ”¯æŒå…¬å…±å¤§å…å’Œç§å¯†æˆ¿é—´åŠŸèƒ½ï¼Œä½¿ç”¨ Server-Sent Events (SSE) å®ç°å®æ—¶æ¶ˆæ¯æ¨é€ã€‚

## ğŸ¯ é¡¹ç›®ç‰¹æ€§

- **æ— éœ€æ³¨å†Œç™»å½•** - è¾“å…¥è‡ªå®šä¹‰IDå³å¯å¼€å§‹èŠå¤©
- **å…¬å…±å¤§å…** - é»˜è®¤è¿›å…¥çš„å…¬å…±èŠå¤©å®¤
- **ç§å¯†æˆ¿é—´** - 6ä½æ•°å­—æˆ¿é—´å·ï¼Œæ”¯æŒåˆ›å»ºå’ŒåŠ å…¥
- **å®æ—¶æ¶ˆæ¯** - Server-Sent Events (SSE) å®æ—¶æ¶ˆæ¯æ¨é€
- **æ–‡ä»¶ä¸Šä¼ ** - æ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£ç­‰ï¼ˆæœ€å¤§10MBï¼‰
- **å“åº”å¼è®¾è®¡** - æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **æ¶ˆæ¯æŒä¹…åŒ–** - SQLiteæ•°æ®åº“å­˜å‚¨
- **åˆå¹¶éƒ¨ç½²** - å‰åç«¯ä¸€ä½“åŒ–éƒ¨ç½²ï¼Œå•ç«¯å£è¿è¡Œ

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| å‰ç«¯ | React 18 + TypeScript + Vite + Axios + CSS Modules + SSE |
| åç«¯ | Node.js + Express + SQLite3 + TypeScript + Multer + SSE |
| åŒ…ç®¡ç† | Bun 1.0+ |
| çŠ¶æ€ç®¡ç† | React Context + useReducer |

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… Server-Sent Events (SSE) å®æ—¶æ¶ˆæ¯æ¨é€
- âœ… React Context + useReducer çŠ¶æ€ç®¡ç†
- âœ… æ–‡ä»¶ä¸Šä¼ æ”¯æŒ (multer, æœ€å¤§10MB)
- âœ… TypeScript å…¨æ ˆç±»å‹å®‰å…¨
- âœ… CSS Modules ç»„ä»¶åŒ–æ ·å¼
- âœ… åˆå¹¶éƒ¨ç½² (å•ç«¯å£æœåŠ¡å‰åç«¯)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- Bun 1.0+

### å¼€å‘ç¯å¢ƒå¯åŠ¨

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/web-chat-system.git
cd web-chat-system

# å®‰è£…ä¾èµ–
bun run install:all

# å¯åŠ¨å¼€å‘ç¯å¢ƒ (å‰åç«¯åˆ†ç¦»)
bun run dev
```

- å‰ç«¯: `http://localhost:5173`
- åç«¯: `http://localhost:3001`

### ç”Ÿäº§ç¯å¢ƒå¯åŠ¨ (åˆå¹¶éƒ¨ç½²)

```bash
# 1. æ„å»ºå‰ç«¯
cd client && bun run build

# 2. å¯åŠ¨åˆå¹¶æœåŠ¡å™¨
cd ../server && bun run merge
# æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬
cd .. && bun start.js
```

- è®¿é—®: `http://localhost:3001`

## é¡¹ç›®ç»“æ„

```
dwahdhada/
â”œâ”€â”€ client/                     # å‰ç«¯é¡¹ç›® (React + TypeScript + Vite)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/         # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatContainer.tsx    # èŠå¤©ä¸»å®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatHeader.tsx       # å¤´éƒ¨ç»„ä»¶ (å·²ç§»é™¤Avatar)
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageList.tsx      # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageInput.tsx     # æ¶ˆæ¯è¾“å…¥ (æ”¯æŒç›¸å¯¹è·¯å¾„ä¸Šä¼ )
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomSelector.tsx     # æˆ¿é—´é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx        # ç™»å½•è¡¨å•
â”‚   â”‚   â”‚   â”œâ”€â”€ ConnectionStatus.tsx # è¿æ¥çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ ui/                  # UIç»„ä»¶åº“ (Button, Input)
â”‚   â”‚   â”œâ”€â”€ context/            # React ContextçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ ChatContext.tsx
â”‚   â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ SSEManager.ts   # SSEå®¢æˆ·ç«¯ç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts          # Axios APIå®¢æˆ·ç«¯ (æ”¯æŒç›¸å¯¹è·¯å¾„)
â”‚   â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ api.ts          # APIé…ç½® (å¤„ç†ç©ºbaseURL)
â”‚   â”‚   â”œâ”€â”€ component/          # ç‰¹æ•ˆç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ Aurora.tsx      # æå…‰èƒŒæ™¯ç‰¹æ•ˆ
â”‚   â”‚   â”œâ”€â”€ types.ts            # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ App.tsx             # åº”ç”¨å…¥å£ (ç§»é™¤NicknameForm)
â”‚   â”‚   â””â”€â”€ main.tsx            # Viteå…¥å£
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ setup-env.js        # ç¯å¢ƒé…ç½®è„šæœ¬
â”‚   â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡ (ç”Ÿäº§ç¯å¢ƒé…ç½®)
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ server/                     # åç«¯é¡¹ç›® (Express + TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/        # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ messageController.ts  # æ¶ˆæ¯å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ roomController.ts     # æˆ¿é—´ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ fileController.ts     # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”‚   â”‚   â””â”€â”€ sseController.ts      # SSEè¿æ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ routes/             # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ messageRoutes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ roomRoutes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ fileRoutes.ts
â”‚   â”‚   â”‚   â””â”€â”€ sseRoutes.ts
â”‚   â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ init.ts         # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”‚   â””â”€â”€ migrate.ts      # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”œâ”€â”€ utils/              # å·¥å…·ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ database.ts     # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”‚   â””â”€â”€ SSEManager.ts   # SSEæœåŠ¡ç«¯ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ types.ts            # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ app.ts              # Expressåº”ç”¨å…¥å£ (æ”¯æŒåˆå¹¶éƒ¨ç½²)
â”‚   â”œâ”€â”€ database/               # SQLiteæ•°æ®åº“æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ chat.db
â”‚   â”œâ”€â”€ uploads/                # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ start.js                    # åˆå¹¶éƒ¨ç½²å¯åŠ¨è„šæœ¬
â”œâ”€â”€ package.json                # æ ¹ç›®å½•åŒ…é…ç½®
â”œâ”€â”€ MERGE_DEPLOY.md             # åˆå¹¶éƒ¨ç½²è¯´æ˜
â”œâ”€â”€ README.md
â”œâ”€â”€ Technical.md                # æŠ€æœ¯æ–‡æ¡£
â”œâ”€â”€ Structure.md                # ç»“æ„è¯´æ˜
â””â”€â”€ Deployment.md               # éƒ¨ç½²æŒ‡å—
```

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯ (React 18)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  App (ChatContext.Provider)       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  ChatContainer              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ ChatHeader              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ RoomSelector            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ MessageList             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ MessageInput            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ ConnectionStatus        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  SSEManager (EventSource)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ HTTP/JSON + SSEæµ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åç«¯ (Express + Node.js)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  app.ts (Expressåº”ç”¨)             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚è·¯ç”±å¤„ç† â”‚  â”‚SSEç®¡ç†å™¨ â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚æ§åˆ¶å™¨   â”‚  â”‚ä¸šåŠ¡é€»è¾‘ â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ SQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ•°æ®åº“ (SQLite3)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ users   â”‚  â”‚ rooms   â”‚  â”‚messages â”‚ â”‚
â”‚  â”‚ status  â”‚  â”‚         â”‚  â”‚         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®æµ:
1. ç”¨æˆ·æ“ä½œ â†’ HTTPè¯·æ±‚ â†’ Expressè·¯ç”± â†’ æ§åˆ¶å™¨
2. æ§åˆ¶å™¨ â†’ æ•°æ®åº“æ“ä½œ â†’ å“åº”
3. å‘é€æ¶ˆæ¯ â†’ SSEå¹¿æ’­ â†’ æ‰€æœ‰è®¢é˜…å®¢æˆ·ç«¯
4. æˆ¿é—´åˆ‡æ¢ â†’ æ–­å¼€æ—§SSE â†’ å»ºç«‹æ–°SSE
```

## æ•°æ®åº“è®¾è®¡

### users è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | è‡ªå¢ä¸»é”® |
| user_id | TEXT | ç”¨æˆ·è‡ªå®šä¹‰IDï¼ˆå”¯ä¸€ï¼‰ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### rooms è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | è‡ªå¢ä¸»é”® |
| room_code | CHAR(6) | 6ä½æ•°å­—æˆ¿é—´å·ï¼ˆå”¯ä¸€ï¼‰ |
| room_name | TEXT | æˆ¿é—´åç§° |
| created_by | TEXT | åˆ›å»ºè€…ID |
| admin_users | TEXT | ç®¡ç†å‘˜åˆ—è¡¨(JSON) |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| is_public | BOOLEAN | æ˜¯å¦å…¬å…±æˆ¿é—´ |

> å…¬å…±å¤§å…: room_code = "PUBLIC", id = 0, is_public = 1

### user_status è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | è‡ªå¢ä¸»é”® |
| user_id | TEXT | ç”¨æˆ·IDï¼ˆå”¯ä¸€ï¼‰ |
| room_id | INTEGER | å½“å‰æˆ¿é—´ID |
| is_online | BOOLEAN | æ˜¯å¦åœ¨çº¿ |
| last_seen | DATETIME | æœ€åæ´»è·ƒæ—¶é—´ |

### messages è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | è‡ªå¢ä¸»é”® |
| room_id | INTEGER | æˆ¿é—´ID |
| user_id | TEXT | å‘é€è€…ID |
| content | TEXT | æ¶ˆæ¯å†…å®¹ |
| message_type | TEXT | ç±»å‹(text/image/file) |
| file_name | TEXT | æ–‡ä»¶å |
| file_url | TEXT | æ–‡ä»¶URL |
| created_at | DATETIME | å‘é€æ—¶é—´ |

## APIæ¥å£

### æˆ¿é—´ç®¡ç†

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/rooms/public` | GET | è·å–å…¬å…±å¤§å…ä¿¡æ¯ |
| `/api/rooms/create` | POST | åˆ›å»ºç§å¯†æˆ¿é—´ |
| `/api/rooms/join/:roomCode` | GET | åŠ å…¥æˆ¿é—´ |

**åˆ›å»ºæˆ¿é—´è¯·æ±‚ä½“ï¼š**
```json
{ "roomCode": "123456", "userId": "user123" }
```

### æ¶ˆæ¯ç®¡ç†

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/messages/send` | POST | å‘é€æ¶ˆæ¯ |
| `/api/messages/:roomId` | GET | è·å–æ¶ˆæ¯ï¼ˆè½®è¯¢ï¼‰ |
| `/api/messages/:roomId/latest` | GET | è·å–æœ€æ–°æ¶ˆæ¯ |
| `/api/sse/:roomId` | GET | å»ºç«‹SSEè¿æ¥ |
| `/api/sse/stats` | GET | è·å–SSEè¿æ¥ç»Ÿè®¡ |

**å‘é€æ¶ˆæ¯è¯·æ±‚ä½“ï¼š**
```json
{ "roomId": 1, "userId": "user123", "content": "Hello" }
```

**è½®è¯¢å‚æ•°ï¼š** `?lastMessageId=100`

**SSEè¿æ¥ï¼š** `GET /api/sse/:roomId?userId=user123`

### æ–‡ä»¶ç®¡ç†

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/files/upload` | POST | ä¸Šä¼ æ–‡ä»¶(multipart/form-data) |
| `/api/files/:filename` | GET | ä¸‹è½½æ–‡ä»¶ |

## æ ¸å¿ƒæœºåˆ¶

### å®æ—¶æ¶ˆæ¯æ¨é€ (SSE)

**å®¢æˆ·ç«¯å®ç° (client/src/utils/SSEManager.ts):**
- ä½¿ç”¨åŸç”Ÿ EventSource API
- æŒ‡æ•°é€€é¿é‡è¿æœºåˆ¶ (æœ€å¤š5æ¬¡)
- æ”¯æŒäº‹ä»¶ç±»å‹: connected, newMessage, userStatus, error

**æœåŠ¡ç«¯å®ç° (server/src/utils/SSEManager.ts):**
- å•ä¾‹æ¨¡å¼ç®¡ç†æ‰€æœ‰è¿æ¥
- æˆ¿é—´è®¢é˜…æ¨¡å‹
- è‡ªåŠ¨æ¸…ç†æ–­å¼€çš„è¿æ¥

**SSEäº‹ä»¶ç¤ºä¾‹ï¼š**
```typescript
// è¿æ¥ç¡®è®¤
{ "type": "connected", "data": { "roomId": 1, "userId": "user123", "timestamp": "..." } }

// æ–°æ¶ˆæ¯æ¨é€
{ "type": "newMessage", "data": { "id": 101, "userId": "user1", "content": "Hello", "messageType": "text", "createdAt": "..." } }

// ç”¨æˆ·çŠ¶æ€å˜åŒ–
{ "type": "userStatus", "data": { "userId": "user456", "status": "online", "timestamp": "..." } }
```

**SSEä¼˜åŠ¿ï¼š**
- âœ… çœŸæ­£çš„å®æ—¶æ¨é€ï¼Œæ— å»¶è¿Ÿ
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶ (æŒ‡æ•°é€€é¿)
- âœ… èµ„æºæ¶ˆè€—ä½ (ç›¸æ¯”è½®è¯¢)
- âœ… åŸç”Ÿæµè§ˆå™¨æ”¯æŒ
- âœ… æ— éœ€WebSocketå¤æ‚é…ç½®

### çŠ¶æ€ç®¡ç† (React Context + useReducer)

**å®ç°ä½ç½®:** `client/src/context/ChatContext.tsx`

**çŠ¶æ€ç»“æ„:**
```typescript
interface AppState {
    currentUser: string;      // å½“å‰ç”¨æˆ·ID
    currentRoom: Room;        // å½“å‰æˆ¿é—´
    messages: Message[];      // æ¶ˆæ¯åˆ—è¡¨
    rooms: Room[];            // å·²åŠ å…¥æˆ¿é—´
    isConnected: boolean;     // è¿æ¥çŠ¶æ€
    isLoading: boolean;       // åŠ è½½çŠ¶æ€
}
```

**Actionç±»å‹:**
- SET_USER / SET_ROOM - è®¾ç½®ç”¨æˆ·/æˆ¿é—´
- SET_MESSAGES / ADD_MESSAGES - è®¾ç½®/æ·»åŠ æ¶ˆæ¯
- SET_LOADING / SET_CONNECTED - è®¾ç½®çŠ¶æ€

### æˆ¿é—´åˆ‡æ¢æµç¨‹

1. ç”¨æˆ·è¾“å…¥6ä½æˆ¿é—´å·
2. å°è¯•åŠ å…¥æˆ¿é—´ (`/api/rooms/join/:code`)
3. è‹¥æˆ¿é—´ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»º (`/api/rooms/create`)
4. **æ›´æ–°React ContextçŠ¶æ€**
5. æ–­å¼€æ—§æˆ¿é—´SSEè¿æ¥
6. å»ºç«‹æ–°æˆ¿é—´SSEè¿æ¥
7. è·å–å†å²æ¶ˆæ¯ (`/api/messages/:roomId/latest`)
8. ç­‰å¾…SSEå®æ—¶æ¨é€

## ç¯å¢ƒé…ç½®

### å‰ç«¯é…ç½® (client/.env)
```env
# ç”Ÿäº§ç¯å¢ƒé…ç½® - åˆå¹¶éƒ¨ç½²ä½¿ç”¨ç›¸å¯¹è·¯å¾„
VITE_API_BASE_URL=
VITE_DEFAULT_API_URL=
VITE_API_TIMEOUT=15000
VITE_NODE_ENV=production
VITE_ENABLE_LOGGING=false
VITE_ENABLE_DEBUG=false
```

### åç«¯é…ç½® (server/.env)
```env
PORT=3001
DATABASE_PATH=./database/chat.db
NODE_ENV=production
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=10485760
# CORSé…ç½® (ç”Ÿäº§ç¯å¢ƒ)
CORS_ORIGIN=https://yourdomain.com
```

## ğŸ“¦ éƒ¨ç½²æ–¹å¼

### å¼€å‘ç¯å¢ƒ (å‰åç«¯åˆ†ç¦»)
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
bun run dev

# è®¿é—®åœ°å€
# å‰ç«¯: http://localhost:5173
# åç«¯: http://localhost:3001
```

### ç”Ÿäº§ç¯å¢ƒ (åˆå¹¶éƒ¨ç½² - æ¨è)
```bash
# æ–¹å¼1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ (æ¨è)
bun start.js

# æ–¹å¼2: æ‰‹åŠ¨æ„å»ºå¹¶å¯åŠ¨
cd client && bun run build
cd ../server && bun run merge

# æ–¹å¼3: ä½¿ç”¨npmè„šæœ¬
cd server && bun run merge
```

**è®¿é—®åœ°å€**: `http://localhost:3001`

### PM2éƒ¨ç½²
```bash
# æ„å»ºå‰ç«¯
cd client && bun run build

# ä½¿ç”¨PM2å¯åŠ¨åç«¯
cd ../server
pm2 start src/app.js --name "chat-server"
pm2 startup && pm2 save
```

### Nginxåå‘ä»£ç† (å¯é€‰)
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶ (å¦‚æœåˆ†ç¦»éƒ¨ç½²)
    location / {
        root /path/to/client/dist;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç† (SSEæ”¯æŒ)
    location /api/ {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;

        # SSEå…³é”®é…ç½®
        proxy_buffering off;
        proxy_set_header Connection '';
        proxy_set_header Cache-Control no-cache;
        proxy_set_header X-Accel-Buffering no;
    }

    # æ–‡ä»¶ä¸Šä¼ 
    location /uploads/ {
        proxy_pass http://localhost:3001;
        client_max_body_size 10M;
    }
}
```

## ğŸ”§ æ ¸å¿ƒå˜æ›´è¯´æ˜

### 1. åˆå¹¶éƒ¨ç½²æ¶æ„
- **å•ç«¯å£**: å‰åç«¯ç»Ÿä¸€åœ¨3001ç«¯å£è¿è¡Œ
- **ç›¸å¯¹è·¯å¾„**: APIè¯·æ±‚ä½¿ç”¨ `/api` ç›¸å¯¹è·¯å¾„
- **é™æ€æœåŠ¡**: Expressç›´æ¥æä¾›å‰ç«¯æ„å»ºæ–‡ä»¶

### 2. ç»„ä»¶ç²¾ç®€
- **ç§»é™¤**: `NicknameForm` ç»„ä»¶ (ç®€åŒ–ç™»å½•æµç¨‹)
- **ç§»é™¤**: `Avatar` ç»„ä»¶ (UIç®€åŒ–)
- **ä¿ç•™**: æ ¸å¿ƒèŠå¤©åŠŸèƒ½ç»„ä»¶

### 3. é…ç½®ä¼˜åŒ–
- **å‰ç«¯**: `VITE_API_BASE_URL=` ç©ºå€¼è¡¨ç¤ºç›¸å¯¹è·¯å¾„
- **åç«¯**: è‡ªåŠ¨å¤„ç†ç©ºbaseURLï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„
- **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒç›¸å¯¹è·¯å¾„ä¸Šä¼ æ¥å£

### 4. ç¯å¢ƒå˜é‡
- **å¼€å‘ç¯å¢ƒ**: `VITE_API_BASE_URL=http://localhost:3001`
- **ç”Ÿäº§ç¯å¢ƒ**: `VITE_API_BASE_URL=` (ç©ºå€¼ï¼Œç›¸å¯¹è·¯å¾„)

## å¸¸è§é—®é¢˜

### ç«¯å£å ç”¨
```bash
# Windows
netstat -ano | findstr :3001
taskkill /PID <PID> /F

# Linux/macOS
lsof -i :3001
kill -9 <PID>
```

### å‰ç«¯æ„å»ºå¤±è´¥
```bash
cd client
rm -rf node_modules bun.lockb
bun install
bun run build
```

### æ–‡ä»¶ä¸Šä¼ å¤±è´¥
```bash
# ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨
mkdir -p server/uploads
chmod 755 server/uploads
```

### SSEè¿æ¥å¤±è´¥
- æ£€æŸ¥ `server/src/app.ts` ä¸­çš„CORSé…ç½®
- ç¡®ä¿ç”Ÿäº§ç¯å¢ƒè®¾ç½® `NODE_ENV=production`
- éªŒè¯é˜²ç«å¢™è®¾ç½®

## ä½¿ç”¨è¯´æ˜

1. **ç™»å½•** - è¾“å…¥è‡ªå®šä¹‰ç”¨æˆ·IDå³å¯å¼€å§‹
2. **å…¬å…±å¤§å…** - é»˜è®¤è¿›å…¥ï¼Œæ‰€æœ‰ç”¨æˆ·å¯è§
3. **ç§å¯†æˆ¿é—´** - è¾“å…¥6ä½æ•°å­—åˆ›å»ºæˆ–åŠ å…¥
4. **å‘é€æ¶ˆæ¯** - è¾“å…¥æ¡†è¾“å…¥ï¼ŒEnterå‘é€
5. **ä¸Šä¼ æ–‡ä»¶** - ç‚¹å‡»ğŸ“æŒ‰é’®ï¼Œæ”¯æŒå›¾ç‰‡å’Œæ–‡æ¡£
6. **å®æ—¶æ¨é€** - SSEè‡ªåŠ¨æ¨é€æ–°æ¶ˆæ¯

---

**ç‰ˆæœ¬**: v1.1.0 (åˆå¹¶éƒ¨ç½²ç‰ˆ)
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**åŒ…ç®¡ç†å™¨**: Bun 1.0+
**éƒ¨ç½²æ¨¡å¼**: å‰åç«¯åˆå¹¶éƒ¨ç½²
