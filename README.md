# è½»é‡çº§ç½‘é¡µèŠå¤©ç³»ç»Ÿ

åŸºäº React + Node.js çš„è½»é‡çº§å®æ—¶èŠå¤©ç³»ç»Ÿï¼Œæ”¯æŒå…¬å…±å¤§å…å’Œç§å¯†æˆ¿é—´åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- **æ— éœ€æ³¨å†Œç™»å½•** - è¾“å…¥è‡ªå®šä¹‰IDå³å¯å¼€å§‹èŠå¤©
- **å…¬å…±å¤§å…** - é»˜è®¤è¿›å…¥çš„å…¬å…±èŠå¤©å®¤
- **ç§å¯†æˆ¿é—´** - 6ä½æ•°å­—æˆ¿é—´å·ï¼Œæ”¯æŒåˆ›å»ºå’ŒåŠ å…¥
- **å®æ—¶æ¶ˆæ¯** - HTTPè½®è¯¢æ¶ˆæ¯æ¨é€ï¼ˆ1ç§’é—´éš”ï¼‰
- **æ–‡ä»¶ä¸Šä¼ ** - æ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£ç­‰ï¼ˆæœ€å¤§10MBï¼‰
- **å“åº”å¼è®¾è®¡** - æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **æ¶ˆæ¯æŒä¹…åŒ–** - SQLiteæ•°æ®åº“å­˜å‚¨

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| å‰ç«¯ | React 18 + TypeScript + Vite + CSS Modules |
| åç«¯ | Node.js + Express + SQLite3 + TypeScript |
| åŒ…ç®¡ç† | Bun 1.0+ |

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- Bun 1.0+

### å®‰è£…å¯åŠ¨

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/web-chat-system.git
cd web-chat-system

# å®‰è£…ä¾èµ–
bun run install:all

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
bun run dev
```

è®¿é—® `http://localhost:5173`

## é¡¹ç›®ç»“æ„

```
web-chat-system/
â”œâ”€â”€ client/                     # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/         # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatContainer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageInput.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomSelector.tsx
â”‚   â”‚   â”‚   â””â”€â”€ LoginForm.tsx
â”‚   â”‚   â”œâ”€â”€ context/            # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ server/                     # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/        # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ messageController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ roomController.ts
â”‚   â”‚   â”‚   â””â”€â”€ fileController.ts
â”‚   â”‚   â”œâ”€â”€ routes/             # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“åˆå§‹åŒ–/è¿ç§»
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ app.ts
â”‚   â”œâ”€â”€ database/               # SQLiteæ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ uploads/                # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”œâ”€â”€ .env
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯ (React)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ç™»å½•è¡¨å• â”‚  â”‚èŠå¤©ç•Œé¢ â”‚  â”‚è½®è¯¢ç»„ä»¶ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ HTTP/JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åç«¯ (Express + Node.js)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚è·¯ç”±å¤„ç† â”‚  â”‚ä¸šåŠ¡é€»è¾‘ â”‚  â”‚æ•°æ®åº“å±‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ SQL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ•°æ®åº“ (SQLite3)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ users   â”‚  â”‚ rooms   â”‚  â”‚messages â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®åº“è®¾è®¡

### users è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | è‡ªå¢ä¸»é”® |
| user_id | TEXT | ç”¨æˆ·è‡ªå®šä¹‰IDï¼ˆå”¯ä¸€ï¼‰ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### rooms è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | è‡ªå¢ä¸»é”® |
| room_code | CHAR(6) | 6ä½æ•°å­—æˆ¿é—´å·ï¼ˆå”¯ä¸€ï¼‰ |
| room_name | TEXT | æˆ¿é—´åç§° |
| created_by | TEXT | åˆ›å»ºè€…ID |
| is_public | BOOLEAN | æ˜¯å¦å…¬å…±æˆ¿é—´ |

> å…¬å…±å¤§å…: room_code = "PUBLIC", id = 0, is_public = 1

### messages è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | è‡ªå¢ä¸»é”® |
| room_id | INTEGER | æˆ¿é—´ID |
| user_id | TEXT | å‘é€è€…ID |
| content | TEXT | æ¶ˆæ¯å†…å®¹ |
| message_type | TEXT | ç±»å‹(text/image/file) |
| file_name | TEXT | æ–‡ä»¶å |
| file_url | TEXT | æ–‡ä»¶URL |
| created_at | DATETIME | å‘é€æ—¶é—´ |

## APIæ¥å£

### æˆ¿é—´ç®¡ç†

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/rooms/public` | GET | è·å–å…¬å…±å¤§å…ä¿¡æ¯ |
| `/api/rooms/create` | POST | åˆ›å»ºç§å¯†æˆ¿é—´ |
| `/api/rooms/join/:roomCode` | GET | åŠ å…¥æˆ¿é—´ |

**åˆ›å»ºæˆ¿é—´è¯·æ±‚ä½“ï¼š**
```json
{ "roomCode": "123456", "userId": "user123" }
```

### æ¶ˆæ¯ç®¡ç†

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/messages/send` | POST | å‘é€æ¶ˆæ¯ |
| `/api/messages/:roomId` | GET | è·å–æ¶ˆæ¯ï¼ˆè½®è¯¢ï¼‰ |
| `/api/messages/:roomId/latest` | GET | è·å–æœ€æ–°æ¶ˆæ¯ |

**å‘é€æ¶ˆæ¯è¯·æ±‚ä½“ï¼š**
```json
{ "roomId": 1, "userId": "user123", "content": "Hello" }
```

**è½®è¯¢å‚æ•°ï¼š** `?lastMessageId=100`

### æ–‡ä»¶ç®¡ç†

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/files/upload` | POST | ä¸Šä¼ æ–‡ä»¶(multipart/form-data) |
| `/api/files/:filename` | GET | ä¸‹è½½æ–‡ä»¶ |

## æ ¸å¿ƒæœºåˆ¶

### æ¶ˆæ¯è½®è¯¢

å®¢æˆ·ç«¯æ¯1ç§’å‘æœåŠ¡å™¨è¯·æ±‚æ–°æ¶ˆæ¯ï¼Œä½¿ç”¨ `lastMessageId` å®ç°å¢é‡è·å–ï¼š

```typescript
// è½®è¯¢è¯·æ±‚
GET /api/messages/1?lastMessageId=100

// å“åº”
{
  "success": true,
  "hasNew": true,
  "messages": [{ "id": 101, "userId": "user1", "content": "Hi" }]
}
```

### æˆ¿é—´åˆ‡æ¢æµç¨‹

1. ç”¨æˆ·è¾“å…¥6ä½æˆ¿é—´å·
2. å°è¯•åŠ å…¥æˆ¿é—´ (`/api/rooms/join/:code`)
3. è‹¥æˆ¿é—´ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»º (`/api/rooms/create`)
4. åœæ­¢æ—§æˆ¿é—´è½®è¯¢ï¼Œå¯åŠ¨æ–°æˆ¿é—´è½®è¯¢

## ç¯å¢ƒé…ç½®

### åç«¯ (server/.env)
```env
PORT=3001
DATABASE_PATH=./database/chat.db
NODE_ENV=development
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=10485760
```

### å‰ç«¯ (client/.env)
```env
VITE_API_BASE_URL=/api
```

## éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ
```bash
bun run dev              # åŒæ—¶å¯åŠ¨å‰åç«¯
bun run server:dev       # ä»…åç«¯ (ç«¯å£3001)
bun run client:dev       # ä»…å‰ç«¯ (ç«¯å£5173)
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# æ„å»º
cd client && bun run build
cd ../server && bun run build

# å¯åŠ¨
bun start
```

### PM2éƒ¨ç½²
```bash
pm2 start server/dist/app.js --name "chat-server"
pm2 startup && pm2 save
```

### Nginxé…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        root /path/to/client/dist;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /uploads {
        proxy_pass http://localhost:3001;
        client_max_body_size 10M;
    }
}
```

## å¸¸è§é—®é¢˜

### ç«¯å£å ç”¨
```bash
# Windows
netstat -ano | findstr :3001
taskkill /PID <PID> /F

# Linux/macOS
lsof -i :3001
kill -9 <PID>
```

### ä¾èµ–å®‰è£…å¤±è´¥
```bash
rm -rf node_modules bun.lockb
bun install
```

### æ–‡ä»¶ä¸Šä¼ å¤±è´¥
```bash
mkdir -p server/uploads
chmod 755 server/uploads
```

## ä½¿ç”¨è¯´æ˜

1. **ç™»å½•** - è¾“å…¥è‡ªå®šä¹‰ç”¨æˆ·ID
2. **å…¬å…±å¤§å…** - é»˜è®¤è¿›å…¥ï¼Œæ‰€æœ‰ç”¨æˆ·å¯è§
3. **ç§å¯†æˆ¿é—´** - è¾“å…¥6ä½æ•°å­—åˆ›å»º/åŠ å…¥
4. **å‘é€æ¶ˆæ¯** - è¾“å…¥æ¡†è¾“å…¥ï¼ŒEnterå‘é€
5. **ä¸Šä¼ æ–‡ä»¶** - ç‚¹å‡»ğŸ“æŒ‰é’®ï¼Œæ”¯æŒå›¾ç‰‡å’Œæ–‡æ¡£

---

**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**åŒ…ç®¡ç†å™¨**: Bun 1.0+
